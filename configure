#!/bin/bash

# Ensure the script is executed with the proper permissions
set -e

echo "Saving GitHub token to .Renviron file..."

# Function to save the GitHub token
save_github_token() {
  # Replace this with a way to retrieve the GitHub token
  # Here, we're assuming it's stored in an environment variable
  AUTH_PAT_TOKEN=${GITHUB_PAT}

  if [ -z "$AUTH_PAT_TOKEN" ]; then
    echo "Error: GITHUB_PAT environment variable is not set."
    exit 1
  fi

  # Path to the user's .Renviron file
  RENENV_FILE="$HOME/.Renviron"

  # Create .Renviron if it doesn't exist
  if [ ! -f "$RENENV_FILE" ]; then
    echo "Creating .Renviron file..."
    touch "$RENENV_FILE"
  fi

  # Remove existing GITHUB_PAT entries
  grep -v '^GITHUB_PAT=' "$RENENV_FILE" > "$RENENV_FILE.tmp"
  mv "$RENENV_FILE.tmp" "$RENENV_FILE"

  # Append the new token
  echo "GITHUB_PAT=$AUTH_PAT_TOKEN" >> "$RENENV_FILE"
  echo "GitHub token saved to .Renviron. Please restart your R session to apply changes."
}

# Call the function
save_github_token
